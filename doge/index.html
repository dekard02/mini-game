<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.w3schools.com/lib/w3data.js"></script>
    <title>Doge</title>
    <style>
        @import url(../style-nav.css);
    </style>
</head>
<body>
    <div id="navbar" w3-include-html="../nav.html"></div>
    <script>
        w3IncludeHTML();
    </script>
    <div id="main">
        <canvas id="canvas" width="1200" height="700" style="background-color: cornflowerblue;"></canvas>
    </div>
    <script type="text/javascript">
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        var dogX = 50;
        var dogY = canvas.height/2-64;
        var dx = 2;
        var dy = -2;
        var dogImg = new Image();
        dogImg.src='dog.png';
        var bulletImg = new Image();
        bulletImg.src = 'bullet.png';
        var bossImg = new Image();
        bossImg.src = 'boss.png';
        var wPress = false;
        var sPress = false;
        var isShot = false;
        var bossX = canvas.width - 300;
        var bossY = canvas.height/2 -152;
        var bulletX = canvas.width - 31;
        var bulletY = dogY + 48;
        var bossHealthMax = 2000;
        var newBossHealth = 2000;
        var damage = 100;

        function drawDog(){
            ctx.beginPath();
            ctx.drawImage(dogImg, dogX, dogY, 64*2.5, 48*2.5);
            //ctx.arc(x, y, 10, 0, Math.PI*2);
            //ctx.fillStyle = "#0095DD";
            //ctx.fill();
            ctx.closePath();    
            //x += dx;
            //y += dy;
        }

        function drawBoss(){
            ctx.beginPath();
            ctx.rect(bossX + 20, bossY - 50, 200, 30);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.closePath();

            ctx.beginPath();
            let value = newBossHealth/bossHealthMax * (200-4);
            ctx.rect(bossX + 22, bossY - 48, value, 30 -4);
            ctx.fillStyle= 'red';
            ctx.fill();
            ctx.closePath();

            ctx.drawImage(bossImg, bossX, bossY, 260,304);
        }

        function drawBullet(x, y){
            ctx.beginPath();
            ctx.drawImage(bulletImg,x,y,32,7);
            ctx.closePath();
        }

        function draw(){
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawDog();
            drawBoss();

            if(isShot == true){
                shot();
            }
            if(wPress) {
                dogY -= 5;
            }
            else if(sPress) {
                dogY += 5;
            }
            requestAnimationFrame(draw);
        }

        function shot(){
            drawBullet(bulletX, bulletY);
            bulletX += 15;
            if(bulletX > canvas.width - 32){ 
                isShot = false;
            }
            if(bulletX + 32 > bossX && bulletY > bossY 
            && bulletY < bossY + 304){
                isShot = false;
                newBossHealth -= damage;
                bulletX = canvas.width - 31;
                console.log(newBossHealth);
            }
            if(newBossHealth <= 0){
                alert("YOU WIN");
                document.location.reload();
            }
        }

        document.addEventListener("keydown",keyDownHandler,false);
        document.addEventListener("keyup",keyUpHandler,false);
        document.addEventListener("mousemove", mouseMoveHandler, false);
        document.addEventListener("mousedown", mouseDownHandler, false);

        function keyDownHandler(e) {
            if(e.keyCode == 87) {
                wPress = true;
            }
                else if(e.keyCode == 83) {
                    sPress = true;
                }
                else if(e.keyCode == 32 && bulletX > canvas.width - 32){
                    isShot = true;
                    bulletX = dogX + 64*2.5 + 5;
                    bulletY = dogY + 48;
                }
        }

        function keyUpHandler(e) {
            if(e.keyCode == 87) {
                wPress = false;
            }
            else if(e.keyCode == 83) {
                sPress = false;
            }
        }

        function mouseMoveHandler(e){
            //var relativeX = e.clientX - canvas.offsetLeft;
                if(e.clientY > 0 && e.clientY < canvas.height) {
                dogY = e.clientY - 64;
            }
        }

        function mouseDownHandler(e){
            if(bulletX > canvas.width - 32){
                    isShot = true;
                    bulletX = dogX + 64*2.5 + 5;
                    bulletY = dogY + 48;
                }
        }

        //setInterval(draw, 10);
        draw();
    </script>
</body>
</html>